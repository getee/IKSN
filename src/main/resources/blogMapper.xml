<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="group.first.iksn.model.dao.BlogDAO">
    <!--定义的一个reaultmap结果集合来存储关联查询到的详细的博客，类型是自定义类型-->
    <resultMap id="searchBlog" type="Blog">

        <id property="bid" column="bid"></id>
        <result property="title" column="title"></result>
        <result property="content" column="content"></result>
        <result property="classify" column="classify"></result>
        <result property="link" column="link"></result>
        <result property="points" column="points"></result>
        <result property="time" column="time"></result>

        <association property="blogTag" javaType="BlogTag">
            <id property="id" column="id"></id>
            <result property="bid" column="bid"></result>
            <result property="btag" column="btag"></result>
        </association>

        <association property="userToBlog" javaType="UserToBlog">
            <id property="id" column="id"></id>
            <result property="uid" column="uid"></result>
            <result property="bid" column="bid"></result>
            <result property="isdraft" column="isdraft"></result>
            <result property="ispublic" column="ispublic"></result>
            <result property="blogtype" column="blogtype"></result>
        </association>
    </resultMap>

    <select id="processScanBlog" resultMap="searchBlog">
        select b.* ,u.*,t.* from blog as b
        inner join usertoblog as u on u.bid=b.bid
        inner join blogtag as t on t.bid=b.bid

    </select>

    <insert id="processAddBlog" parameterType="Blog" useGeneratedKeys="true" keyColumn="bid">
        insert into blog(title,content,time,classify) values (#{title},#{content},#{time},#{classify})
    </insert>
     <!--定义的一个reaultmap结果集合来存储关联查询到的详细的博客，类型是自定义类型-->
    <resultMap id="searchResultMap" type="Blog">

    </resultMap>
    <!--向illegalblog表中插入违规博客信息-->
    <insert id="addIllegalblog" parameterType="IllegalBlog">
        insert into illegalblog(bid,illegalcause) values (#{bid},#{illegalcause})
    </insert>
    <!--从illegalblog表中获取所有博客信息-->
    <select id="getAllReportBlog111" resultType="IllegalBlog">
        select * from illegalblog
    </select>
    <!--从reportBlog表中根据id删除一个选中行-->
    <delete id="deleteBlogFromReport" parameterType="ReportBlog">
      delete from reportblog where id = #{id}
    </delete>


    <insert id="processAddBlogTag" parameterType="BlogTag" useGeneratedKeys="true" keyColumn="id">
        insert into blogtag(bid,btag) values (#{bid},#{btag})
    </insert>

    <insert id="processAddUserToBlog" parameterType="UserToBlog" useGeneratedKeys="true" keyColumn="id">
        insert into usertoblog(uid,bid,ISDRAFT,ISPUBLIC,BLOGTYPE) values (#{uid},#{bid},#{isdraft},#{ispublic},#{blogtype})
    </insert>
    <!--结果集合用来存储查询ReportBlog表级联查询blog表-->
    <resultMap id="getBlogBy_Reportbid" type="ReportBlog">
        <id column="id" property="id"/>
        <result column="uid" property="uid"/>
        <result column="reason" property="reason"/>

        <association property="blog" column="bid" javaType="Blog">
            <id column="bid" property="bid"/>
            <result column="title" property="title"/>
        </association>
    </resultMap>
    <select id="getAllReportBlog" resultMap="getBlogBy_Reportbid">
		select  i.ID,i.BID,i.REASON,b.TITLE  from reportblog as i
		inner join blog as b on   i.BID=b.BID ORDER BY i.ID desc limit 0,3;
	</select>

</mapper>